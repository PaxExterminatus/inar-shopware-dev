!function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="/bundles/webarmanager/",n(n.s="mqL3")}({"+9Zg":function(e,t,n){},"21Au":function(e,t){e.exports='{% block sw_product_list_grid_columns %}\n\t{% parent %}\n\t{% block sw_product_list_grid_columns_webarModelId %}\n\t\t<template #column-webarModelId="{ item }">\n\t\t\t{% block sw_product_list_grid_columns_webarModelId_content %}\n\t\t\t\t<template>\n\t\t\t\t\t<template v-if="item.customFields && item.customFields.inar_webar_model_usdz && item.customFields.inar_webar_model_glb && !item.customFields.inar_webar_webar_disable">\n\t\t\t\t\t\t<sw-icon name="small-default-checkmark-line-medium" small class="is--active"/>\n\t\t\t\t\t</template>\n\t\t\t\t\t<template v-else>\n\t\t\t\t\t\t<sw-icon name="small-default-x-line-medium" class="is--inactive" small/>\n\t\t\t\t\t</template>\n\t\t\t\t</template>\n\t\t\t{% endblock %}\n\t\t</template>\n\t{% endblock %}\n{% endblock %}\n'},"5n8v":function(e,t){e.exports='<div class="inar-webar-manager">\n\n  <template v-if="productIsNew">\n    <inar-message type="error" label="This product is new">\n      {{ \'Save product when editing\' }}\n    </inar-message>\n  </template>\n\n  <template v-if="!productIsNew">\n    <inar-message :type="storeGlb ? \'success\' : \'error\'" label="Current GLB file">\n      {{ storeGlb ? storeGlb : \'To activate WebAR upload GLB file\' }}\n    </inar-message>\n\n    <label class="inar-label">\n      Upload GLB file\n      <inar-drop-wrapper @drop="onDropFilesGlb" :loading="state.loading.glb">\n        <sw-file-input\n            :filename="storeGlb"\n            @onFileInputChange="onFileInputChangeGlb"\n        ></sw-file-input>\n      </inar-drop-wrapper>\n    </label>\n\n    <inar-message :type="storeUsdz ? \'success\' : \'error\'" label="Current USDZ file">\n      {{ storeUsdz ? storeUsdz : \'To activate WebAR upload USDZ file\' }}\n    </inar-message>\n\n    <label class="inar-label">\n      Upload USDZ file\n      <inar-drop-wrapper @drop="onDropFilesUsdz" :loading="state.loading.usdz">\n        <sw-file-input\n            :filename="storeUsdz"\n            @onFileInputChange="onFileInputChangeUsdz"\n        ></sw-file-input>\n      </inar-drop-wrapper>\n    </label>\n\n    <sw-switch-field label="Disable WebAR" v-model="storeDisabled"/>\n  </template>\n\n  <sw-modal class="inar-modal-message" v-if="modal.on">\n    <template slot="modal-header" style="justify-content: flex-start">\n      <sw-icon class="inar-badge-error-icon" name="default-badge-error" color="#ff6961"/>\n      {{ modal.title }}\n    </template>\n\n    {{ modal.text }}\n\n    <template slot="modal-footer">\n      <sw-button @click="modalOff">\n        Close\n      </sw-button>\n    </template>\n  </sw-modal>\n</div>\n'},"86nB":function(e,t,n){var r=n("ZPv6");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,n("SZ7m").default)("9179500e",r,!0,{})},GPHk:function(e,t){e.exports='<div class="inar-drop-wrapper" :class="wrapperClass" @dragover="dragover" @dragleave="dragleave" @drop="drop">\n  <slot></slot>\n\n  <div v-if="loading" class="upload-spinner">\n    <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="margin: auto; display: block; shape-rendering: auto;" viewBox="0 0 100 100" preserveAspectRatio="xMidYMid">\n      <circle cx="50" cy="50" r="32" stroke-width="8" stroke="#1d3f72" stroke-dasharray="50.26548245743669 50.26548245743669" fill="none" stroke-linecap="round">\n        <animateTransform attributeName="transform" type="rotate" dur="1s" repeatCount="indefinite" keyTimes="0;1" values="0 50 50;360 50 50"></animateTransform>\n      </circle>\n      <circle cx="50" cy="50" r="23" stroke-width="8" stroke="#5699d2" stroke-dasharray="36.12831551628262 36.12831551628262" stroke-dashoffset="36.12831551628262" fill="none" stroke-linecap="round">\n        <animateTransform attributeName="transform" type="rotate" dur="1s" repeatCount="indefinite" keyTimes="0;1" values="0 50 50;-360 50 50"></animateTransform>\n      </circle>\n    </svg>\n  </div>\n</div>\n'},OeXv:function(e,t){e.exports='<div class="inar-message error">\n  <div class="message-label">\n    <sw-icon :name="icon" :color="color"/>\n    <span>{{ label }}</span>\n  </div>\n  <div class="message-content">\n    <slot></slot>\n  </div>\n</div>\n'},SZ7m:function(e,t,n){"use strict";function r(e,t){for(var n=[],r={},o=0;o<t.length;o++){var i=t[o],a=i[0],s={id:e+":"+o,css:i[1],media:i[2],sourceMap:i[3]};r[a]?r[a].parts.push(s):n.push(r[a]={id:a,parts:[s]})}return n}n.r(t),n.d(t,"default",(function(){return m}));var o="undefined"!=typeof document;if("undefined"!=typeof DEBUG&&DEBUG&&!o)throw new Error("vue-style-loader cannot be used in a non-browser environment. Use { target: 'node' } in your Webpack config to indicate a server-rendering environment.");var i={},a=o&&(document.head||document.getElementsByTagName("head")[0]),s=null,l=0,u=!1,c=function(){},d=null,p="data-vue-ssr-id",f="undefined"!=typeof navigator&&/msie [6-9]\b/.test(navigator.userAgent.toLowerCase());function m(e,t,n,o){u=n,d=o||{};var a=r(e,t);return h(a),function(t){for(var n=[],o=0;o<a.length;o++){var s=a[o];(l=i[s.id]).refs--,n.push(l)}t?h(a=r(e,t)):a=[];for(o=0;o<n.length;o++){var l;if(0===(l=n[o]).refs){for(var u=0;u<l.parts.length;u++)l.parts[u]();delete i[l.id]}}}}function h(e){for(var t=0;t<e.length;t++){var n=e[t],r=i[n.id];if(r){r.refs++;for(var o=0;o<r.parts.length;o++)r.parts[o](n.parts[o]);for(;o<n.parts.length;o++)r.parts.push(b(n.parts[o]));r.parts.length>n.parts.length&&(r.parts.length=n.parts.length)}else{var a=[];for(o=0;o<n.parts.length;o++)a.push(b(n.parts[o]));i[n.id]={id:n.id,refs:1,parts:a}}}}function g(){var e=document.createElement("style");return e.type="text/css",a.appendChild(e),e}function b(e){var t,n,r=document.querySelector("style["+p+'~="'+e.id+'"]');if(r){if(u)return c;r.parentNode.removeChild(r)}if(f){var o=l++;r=s||(s=g()),t=w.bind(null,r,o,!1),n=w.bind(null,r,o,!0)}else r=g(),t=_.bind(null,r),n=function(){r.parentNode.removeChild(r)};return t(e),function(r){if(r){if(r.css===e.css&&r.media===e.media&&r.sourceMap===e.sourceMap)return;t(e=r)}else n()}}var v,y=(v=[],function(e,t){return v[e]=t,v.filter(Boolean).join("\n")});function w(e,t,n,r){var o=n?"":r.css;if(e.styleSheet)e.styleSheet.cssText=y(t,o);else{var i=document.createTextNode(o),a=e.childNodes;a[t]&&e.removeChild(a[t]),a.length?e.insertBefore(i,a[t]):e.appendChild(i)}}function _(e,t){var n=t.css,r=t.media,o=t.sourceMap;if(r&&e.setAttribute("media",r),d.ssrId&&e.setAttribute(p,t.id),o&&(n+="\n/*# sourceURL="+o.sources[0]+" */",n+="\n/*# sourceMappingURL=data:application/json;base64,"+btoa(unescape(encodeURIComponent(JSON.stringify(o))))+" */"),e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}},WR2L:function(e,t){e.exports='{% block sw_product_detail_base_basic_info_card %}\n  {% parent %}\n\n  <sw-card title="WebAR">\n    <inar-webar-manager/>\n  </sw-card>\n\n{% endblock %}\n'},ZPv6:function(e,t,n){},aJTn:function(e,t,n){},j3Wg:function(e,t,n){var r=n("+9Zg");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,n("SZ7m").default)("e0a00692",r,!0,{})},jf9v:function(e,t){e.exports=""},mqL3:function(e,t,n){"use strict";n.r(t);var r=n("OeXv"),o=n.n(r);n("sq5V");Shopware.Component.register("inar-message",{template:o.a,props:{type:{type:String,default:""},message:{type:String,default:""},label:{type:String,default:""}},computed:{icon:function(){return"error"===this.type?"default-badge-error":"success"===this.type?"small-default-checkmark-line-medium":void 0},color:function(){return"error"===this.type?"#ff6961":"success"===this.type?"#57d9a3":void 0}}});var i=n("5n8v"),a=n.n(i),s=(n("86nB"),Shopware),l=s.Component,u=s.Mixin;l.register("inar-webar-manager",{template:a.a,inject:["systemConfigApiService","WebARApiService"],mixins:[u.getByName("notification")],data:function(){return{state:{loading:{glb:!1,usdz:!1}},input:{glb:"",usdz:""},modal:{on:!1,text:"",title:""}}},computed:{storeGlb:{get:function(){return this.input.glb?this.input.glb:this.storageCustomFields?this.storageCustomFields.inar_webar_model_glb:""},set:function(e){this.input.glb=e,this.$store.state.swProductDetail.product.customFields||(this.$store.state.swProductDetail.product.customFields={}),this.$store.state.swProductDetail.product.customFields.inar_webar_model_glb=e}},storeUsdz:{get:function(){return this.input.usdz?this.input.usdz:this.storageCustomFields?this.storageCustomFields.inar_webar_model_usdz:""},set:function(e){this.input.usdz=e,this.$store.state.swProductDetail.product.customFields||(this.$store.state.swProductDetail.product.customFields={}),this.$store.state.swProductDetail.product.customFields.inar_webar_model_usdz=e}},storeDisabled:{get:function(){return!!this.storageCustomFields&&this.storageCustomFields.inar_webar_webar_disable},set:function(e){this.$store.state.swProductDetail.product.customFields||(this.$store.state.swProductDetail.product.customFields={}),this.$store.state.swProductDetail.product.customFields.inar_webar_webar_disable=e}},productIsNew:function(){return this.storageProduct._isNew},productId:function(){return this.storageProduct.id},productName:function(){return this.storageProduct.name},productNumber:function(){return this.storageProduct.productNumber},storageProduct:function(){return Shopware.State.get("swProductDetail").product},storageCustomFields:function(){return this.storageProduct.customFields}},methods:{setModelId:function(e){this.$store.state.swProductDetail.product.customFields.inar_webar_model_id=e},onDropFilesGlb:function(e){this.acceptFileGlb(e.dataTransfer.files[0])},onDropFilesUsdz:function(e){this.acceptFileUsdz(e.dataTransfer.files[0])},formDataMake:function(){var e=new FormData;return e.append("sku",this.productNumber),e.append("name",this.productName),e},onFileInputChangeGlb:function(e){this.acceptFileGlb(e.target.files[0])},updateProduct:function(e){var t=e.id,n=e.mid,r=e.glb,o=e.usdz;return this.WebARApiService.update({id:t,mid:n,glb:r,usdz:o})},onFileInputChangeUsdz:function(e){this.acceptFileUsdz(e.target.files[0])},acceptFileGlb:function(e){var t=this;if(this.checkFile(e,"glb",10)){var n=this.formDataMake();n.append("glb",e),this.state.loading.glb=!0,this.inarApiSendWebarData(n).then((function(n){t.updateProduct({id:t.productId,mid:n.model.id,glb:e.name}).then((function(){t.storeGlb=e.name,t.setModelId(n.model.id)})).finally((function(){t.state.loading.glb=!1}))})).catch((function(){t.state.loading.glb=!1}))}},acceptFileUsdz:function(e){var t=this;if(this.checkFile(e,"usdz",10)){var n=this.formDataMake();n.append("usdz",e),this.state.loading.usdz=!0,this.inarApiSendWebarData(n).then((function(n){t.updateProduct({id:t.productId,mid:n.model.id,usdz:e.name}).then((function(){t.storeUsdz=e.name,t.setModelId(n.model.id)})).finally((function(){t.state.loading.usdz=!1}))})).catch((function(){t.state.loading.usdz=!1}))}},checkFile:function(e,t,n){var r=!0;return this.productName||(this.errorProductName(),r=!1),this.productNumber||(this.errorProductNumber(),r=!1),e.name.includes(".".concat(t))||(this.errorFileExtension(t),r=!1),e.size>1024*n*1024&&(this.errorFileSize(),r=!1),r},errorProductName:function(){this.createNotificationError({message:"Missing product name."})},errorProductNumber:function(){this.createNotificationError({message:"Missing product number."})},errorFileExtension:function(e){this.createNotificationError({message:"The file has the wrong extension. Expected ".concat(e)})},errorFileSize:function(){this.createNotificationError({message:"The file is too large. File size should not exceed 10 megabytes."})},inarApiSendWebarData:function(e){var t=this,n={method:"POST",body:e,redirect:"follow",headers:new Headers};return this.systemConfigApiService.getValues("WebARManager.config").then((function(e){var r=e["WebARManager.config.authToken"];if(r)return n.headers.append("Accept","application/json"),n.headers.append("Authorization","Bearer "+r),t.inarApiSendWebarFetch("https://qa-app.theinar.com/api/webArModel",n).then((function(e){return e}));throw t.modalTokenNotSpecified(),"The access token is not specified in the plugin settings. Specify the token in the plugin settings."}))},inarApiSendWebarFetch:function(e,t){var n=this;return fetch(e,t).then((function(e){if(e.ok)return e.json();throw e})).then((function(e){return e})).catch((function(e){return 401===e.status&&n.modalTokenUnauthorized(),Promise.reject(e)}))},modalOff:function(){this.modal.on=!1},modalOn:function(e,t){var n=this.modal;n.on=!0,t&&(n.text=t),e&&(n.title=e)},modalTokenUnauthorized:function(){this.modalOn("Access Token Error","Your access token failed authorization. Specify the correct token in the plugin settings.")},modalTokenNotSpecified:function(){this.modalOn("Access Token Error","The access token is not specified in the plugin settings. Specify the token in the plugin settings.")}}});var c=n("GPHk"),d=n.n(c);n("j3Wg");Shopware.Component.register("inar-drop-wrapper",{template:d.a,props:{loading:{type:Boolean,default:!1}},data:function(){return{state:{dragover:!1}}},computed:{wrapperClass:function(){return{loading:this.loading,dragover:this.state.dragover}}},methods:{dragover:function(e){e.preventDefault(),this.state.dragover=!0},dragleave:function(e){this.state.dragover=!1},drop:function(e){this.$emit("drop",e),this.state.dragover=!1}}});var p=n("WR2L"),f=n.n(p);Shopware.Component.override("sw-product-detail-base",{template:f.a});var m=n("jf9v"),h=n.n(m);Shopware.Component.override("sw-file-input",{template:h.a,methods:{onFileInputChange:function(e){this.$emit("onFileInputChange",e)}}});var g=n("21Au"),b=n.n(g);function v(e){return function(e){if(Array.isArray(e))return y(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return y(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return y(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function w(e){return(w="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function S(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function k(e,t){return(k=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function F(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=P(e);if(t){var o=P(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return C(this,n)}}function C(e,t){if(t&&("object"===w(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function P(e){return(P=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}Shopware.Component.override("sw-product-list",{template:b.a,computed:{productColumns:function(){return[].concat(v(this.getProductColumns()),[{property:"webarModelId",dataIndex:"webarModelId",label:"WebAR availability",allowResize:!0,align:"center",sortable:!1}])}}});var x=Shopware.Classes.ApiService,z=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&k(e,t)}(i,e);var t,n,r,o=F(i);function i(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"_action";return _(this,i),o.call(this,e,t,n)}return t=i,(n=[{key:"update",value:function(e){var t=this.getBasicHeaders(),n={id:e.id,mid:e.mid,usdz:e.usdz||null,glb:e.glb||null};return this.httpClient.post("".concat(this.getApiBasePath(),"/theinarupdate"),n,{headers:t}).then((function(e){return x.handleResponse(e)}))}}])&&S(t.prototype,n),r&&S(t,r),Object.defineProperty(t,"prototype",{writable:!1}),i}(x),A=Shopware.Application;A.addServiceProvider("WebARApiService",(function(e){var t=A.getContainer("init");return new z(t.httpClient,e.loginService)}))},sq5V:function(e,t,n){var r=n("aJTn");r.__esModule&&(r=r.default),"string"==typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);(0,n("SZ7m").default)("8cdbb9d2",r,!0,{})}});